{% extends "dashboard/layout.html" %}

{% block extra_css %}
<style>
/* ===== Container ===== */
.ai-reports-container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }

/* ===== Page Header ===== */
.ai-reports-container h1 {
    font-size: 36px; font-weight: 800; color: #2A6B4E;
    margin-bottom: 10px; background: linear-gradient(135deg, #2A6B4E 0%, #4CAF50 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    display: flex; align-items: center; gap: 15px;
}
.ai-reports-container h1::before { content: "ðŸ¤–"; font-size: 40px; -webkit-text-fill-color: initial; }
.page-subtitle { color: #718096; font-size: 18px; margin-bottom: 40px; max-width: 600px; line-height: 1.6; }

/* ===== Stats Cards ===== */
.reports-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
.stat-card { background: white; border-radius: 16px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); border:1px solid #e2e8f0; transition: all 0.3s ease; }
.stat-card:hover { transform: translateY(-5px); box-shadow:0 8px 30px rgba(0,0,0,0.12); border-color:#2A6B4E; }
.stat-card .stat-icon { width:50px;height:50px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;margin-bottom:15px; }
.stat-card:nth-child(1) .stat-icon { background:linear-gradient(135deg,#2A6B4E15,#4CAF5015); color:#2A6B4E; }
.stat-card:nth-child(2) .stat-icon { background:linear-gradient(135deg,#f59e0b15,#fbbf2415); color:#f59e0b; }
.stat-card:nth-child(3) .stat-icon { background:linear-gradient(135deg,#10b98115,#34d39915); color:#10b981; }
.stat-card:nth-child(4) .stat-icon { background:linear-gradient(135deg,#3b82f615,#60a5fa15); color:#3b82f6; }
.stat-card .stat-value { font-size:28px;font-weight:700;color:#2d3748;margin-bottom:5px; }
.stat-card .stat-label { color:#718096;font-size:14px;font-weight:500; }

/* ===== Reports Grid ===== */
.reports-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(350px,1fr)); gap:25px; margin-top:30px; }

/* ===== Report Card ===== */
.report-card { background:white;border-radius:20px;padding:25px;box-shadow:0 4px 20px rgba(0,0,0,0.06);border:1px solid #e2e8f0;transition:all 0.4s cubic-bezier(0.4,0,0.2,1);position:relative;overflow:hidden; display:flex; flex-direction:column;}
.report-card::before { content:''; position:absolute; top:0; left:0; right:0; height:4px; background:linear-gradient(90deg,#2A6B4E 0%,#4CAF50 100%);}
.report-card:hover { transform:translateY(-8px) scale(1.01); box-shadow:0 15px 40px rgba(42,107,78,0.15); border-color:#2A6B4E;}

/* Header */
.report-card-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:20px; padding-bottom:15px; border-bottom:2px solid #f7fafc; }
.doctor-info { display:flex; align-items:center; gap:12px; }
.doctor-icon { width:40px; height:40px; background:linear-gradient(135deg,#2A6B4E,#4CAF50); border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-size:18px; font-weight:600; }
.doctor-details h4 { margin:0; font-size:16px; font-weight:700; color:#2d3748; }
.doctor-details p { margin:3px 0 0 0; color:#718096; font-size:13px; font-weight:500; }
.report-status { padding:6px 15px; border-radius:20px; font-size:12px; font-weight:600; }
.report-status.pending { background:linear-gradient(135deg,#fef3c7,#fbbf24); color:#92400e; }
.report-status.reviewed { background:linear-gradient(135deg,#d1fae5,#10b981); color:#065f46; }

/* Body */
.report-card-body { flex:1; margin-bottom:20px; }
.prediction h5, .detected-issues h5, .confidence-score h5 { margin:0 0 10px 0; font-size:14px; font-weight:600; display:flex; align-items:center; gap:6px; }
.detected-issues { background:#f8fafc;border-radius:12px;padding:18px;margin-bottom:20px;border:1px solid #e2e8f0; }
.issues-tags { display:flex; flex-wrap:wrap; gap:8px; }
.issue-tag { background:white;border:1px solid #e2e8f0; padding:6px 12px; border-radius:20px; font-size:12px; font-weight:500; color:#4a5568; }
.issue-tag:hover { background:#2A6B4E;color:white;border-color:#2A6B4E; transform:translateY(-2px); }

.confidence-score { display:flex; align-items:center; justify-content:space-between; background:linear-gradient(135deg,#2A6B4E08,#4CAF5008); padding:15px; border-radius:12px; border:1px dashed #2A6B4E30; }
.score-value { font-size:20px; font-weight:700; color:#2A6B4E; }

.report-card-body img { max-width:100%; height:auto; border-radius:8px; margin-top:12px; object-fit:cover; max-height:250px; }

/* Footer */
.report-card-footer { display:flex; justify-content:space-between; align-items:center; padding-top:20px; border-top:2px solid #f7fafc; }
.report-date { color:#718096; font-size:13px; display:flex; align-items:center; gap:6px; }
.report-date i { color:#a0aec0; }

.btn-delete-report { background-color:#e74c3c; color:white; border:none; padding:6px 12px; border-radius:5px; cursor:pointer; font-size:0.9rem; margin-top:10px; }
.btn-delete-report:hover { background-color:#c0392b; }
</style>
{% endblock %}

{% block dashboard_content %}
<div class="ai-reports-container">
    <h1>Your AI Reports</h1>
    <p class="page-subtitle">
        Comprehensive AI-powered health analysis reports sent to your doctors for review
    </p>

    <!-- Stats -->
    <div class="reports-stats">
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-file-alt"></i></div>
            <div class="stat-value">{{ reports|length }}</div>
            <div class="stat-label">Total Reports</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-clock"></i></div>
            <div class="stat-value">{{ pending_count }}</div>
            <div class="stat-label">Pending Review</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
            <div class="stat-value">{{ reviewed_count }}</div>
            <div class="stat-label">Reviewed</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-user-md"></i></div>
            <div class="stat-value">{{ total_doctors }}</div>
            <div class="stat-label">Doctors Consulted</div>
        </div>
    </div>

    {% if reports %}
    <div class="reports-grid">
        {% for report in reports %}
        <div class="report-card">
            <!-- Header -->
            <div class="report-card-header">
    <div class="doctor-info">
        <div class="doctor-icon">
            {% if report.doctor %}
                {{ report.doctor.get_full_name|default:report.doctor.username|first }}
            {% else %}
                â€”
            {% endif %}
        </div>
        <div class="doctor-details">
            <h4>
                {% if report.doctor %}
                    Dr. {{ report.doctor.get_full_name|default:report.doctor.username }}
                {% else %}
                    Dr. â€”
                {% endif %}
            </h4>
            <p>
                {% if report.doctor and report.doctor.doctorprofile %}
                    {{ report.doctor.doctorprofile.specialization|default:"Specialist" }}
                {% else %}
                    Specialist
                {% endif %}
            </p>
        </div>
    </div>
    <div class="report-status {{ report.status }}">
        {% if report.status == "pending" %}
            <i class="fas fa-clock"></i> Pending
        {% else %}
            <i class="fas fa-check"></i> Reviewed
        {% endif %}
    </div>
</div>


            <!-- Body -->
            <div class="report-card-body">
                <div class="patient-info">
                    <p><strong>Age:</strong> {{ report.age_display|default:"â€”" }}</p>
                    <p><strong>Gender:</strong> {{ report.gender_display|default:"â€”" }}</p>
                </div>

                <div class="prediction">
                    <h5><i class="fas fa-stethoscope"></i> AI Prediction</h5>
                    <p>{{ report.filtered_prediction|join:", "|default:"â€”" }}</p>
                </div>

                <div class="detected-issues">
                    <h5><i class="fas fa-exclamation-triangle"></i> Detected Issues</h5>
                    <div class="issues-tags">
                        {% if report.filtered_issues %}
                            {% for issue in report.filtered_issues %}
                                <span class="issue-tag">{{ issue }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="issue-tag">None</span>
                        {% endif %}
                    </div>
                </div>

                <div class="confidence-score">
                    <h5><i class="fas fa-chart-line"></i> AI Confidence</h5>
                    <div class="score-value">{{ report.confidence_display }}%</div>
                </div>

                {% if report.annotated_image %}
                    <img src="{{ report.annotated_image.url }}?{{ report.id }}" alt="Annotated Skin Analysis">
                {% else %}
                    <p class="no-image">No annotated image available.</p>
                {% endif %}
            </div>

            <!-- Footer -->
            <div class="report-card-footer">
                <div class="report-date">
                    <i class="far fa-calendar"></i> {{ report.created_at|date:"M d, Y â€¢ h:i A" }}
                </div>
                <form method="POST" action="{% url 'delete_ai_report' report.id %}" onsubmit="return confirm('Are you sure you want to delete this report?');">
                    {% csrf_token %}
                    <button type="submit" class="btn-delete-report">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-reports-state">
        <div class="ai-robot">ðŸ¤–</div>
        <h3>No AI Reports Yet</h3>
        <p>Your AI-powered health analysis reports will appear here once generated.</p>
        <a href="{% url 'model_page' %}" class="btn-generate-report"><i class="fas fa-bolt"></i> Generate Your First Report</a>
    </div>
    {% endif %}
</div>
{% endblock %}
